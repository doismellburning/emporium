{% extends "base.html" %}

{% block content %}
	<div>
		<h2>{{ package }}</h2>
		<form action="{% url 'fetch-latest-package-version' pk=package.id %}" method="post">
			{% csrf_token %}
			<input type="submit" value="Fetch latest package version" />
		</form>
		<ul>
			{% for pv in package.packageversion_set.all %}
				<li>
					<h3>{{ pv.version }}</h3>

					<h4>Depends On</h4>
					<ul>
						{% for dependency in pv.dependency_set.all %}
							<li>{{ dependency.package.name }} (<code>{{ dependency.specification }}</code>)</li>
						{% endfor %}
					</ul>

					<h4><code>setup.py</code></h4>
					<pre>{{ pv.setuppy|linebreaksbr }}</pre>

					{% if user.is_authenticated %}
						{% if pv.fetched %}
							<a href={% url 'parse-setuppy' name=package.name version=pv.version  %}>Parse setup.py</a>
						{% else %}
							<form action="{% url 'fetch-setuppy' name=package.name version=pv.version %}" method="post">
								{% csrf_token %}
								<input type="submit" value="Fetch setup.py" />
							</form>
						{% endif %}
					{% endif %}
				</li>
			{% endfor %}
		</ul>
	</div>
{% endblock %}
